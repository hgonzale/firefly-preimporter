[tox]
env_list = py311, format, lint, types
requires = tox-uv>=1.11

[testenv]
description = Run the test suite via pytest
package = wheel
wheel_build_env = .pkg
extras =
deps =
    pytest>=8.3
    pytest-cov>=5.0
commands =
    pytest --cov=firefly_preimporter --cov-report=term-missing {posargs:tests}

[testenv:lint]
description = Static analysis with Ruff
skip_install = true
deps =
    ruff>=0.6.9
commands =
    ruff check src tests stubs
    ruff format --check src tests stubs

[testenv:types]
description = Static type checking with ty
deps =
    ty>=0.0.2
    pytest>=8.3
commands =
    ty check --extra-search-path src --extra-search-path stubs src tests

[testenv:format]
description = Auto-fix lint issues with Ruff
skip_install = true
deps =
    ruff>=0.6.9
commands =
    ruff check --fix src tests stubs
    ruff format src tests stubs

[testenv:brew-resources]
description = Regenerate PyPI resource blocks in the Homebrew formula template
skip_install = true
deps =
    requests
commands =
    python homebrew/update_resources.py
